{"remainingRequest":"/Users/caichaosen/Code/web/hrm-ui2/node_modules/babel-loader/lib/index.js!/Users/caichaosen/Code/web/hrm-ui2/node_modules/eslint-loader/index.js??ref--13-0!/Users/caichaosen/Code/web/hrm-ui2/src/store/modules/user.js","dependencies":[{"path":"/Users/caichaosen/Code/web/hrm-ui2/src/store/modules/user.js","mtime":1612489294974},{"path":"/Users/caichaosen/Code/web/hrm-ui2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/caichaosen/Code/web/hrm-ui2/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/caichaosen/Code/web/hrm-ui2/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIik7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDsKCnZhciBfbG9naW4gPSByZXF1aXJlKCJAL2FwaS9sb2dpbiIpOwoKdmFyIF9hdXRoID0gcmVxdWlyZSgiQC91dGlscy9hdXRoIik7Cgp2YXIgdXNlciA9IHsKICBzdGF0ZTogewogICAgdG9rZW46ICgwLCBfYXV0aC5nZXRUb2tlbikoKSwKICAgIG5hbWU6ICcnLAogICAgYXZhdGFyOiAnJywKICAgIHJvbGVzOiBbXSwKICAgIHBlcm1pc3Npb25zOiBbXQogIH0sCiAgbXV0YXRpb25zOiB7CiAgICBTRVRfVE9LRU46IGZ1bmN0aW9uIFNFVF9UT0tFTihzdGF0ZSwgdG9rZW4pIHsKICAgICAgc3RhdGUudG9rZW4gPSB0b2tlbjsKICAgIH0sCiAgICBTRVRfTkFNRTogZnVuY3Rpb24gU0VUX05BTUUoc3RhdGUsIG5hbWUpIHsKICAgICAgc3RhdGUubmFtZSA9IG5hbWU7CiAgICB9LAogICAgU0VUX0FWQVRBUjogZnVuY3Rpb24gU0VUX0FWQVRBUihzdGF0ZSwgYXZhdGFyKSB7CiAgICAgIHN0YXRlLmF2YXRhciA9IGF2YXRhcjsKICAgIH0sCiAgICBTRVRfUk9MRVM6IGZ1bmN0aW9uIFNFVF9ST0xFUyhzdGF0ZSwgcm9sZXMpIHsKICAgICAgc3RhdGUucm9sZXMgPSByb2xlczsKICAgIH0sCiAgICBTRVRfUEVSTUlTU0lPTlM6IGZ1bmN0aW9uIFNFVF9QRVJNSVNTSU9OUyhzdGF0ZSwgcGVybWlzc2lvbnMpIHsKICAgICAgc3RhdGUucGVybWlzc2lvbnMgPSBwZXJtaXNzaW9uczsKICAgIH0KICB9LAogIGFjdGlvbnM6IHsKICAgIExvZ2luOiBmdW5jdGlvbiBMb2dpbihfcmVmLCB0b1JvdXRlKSB7CiAgICAgIHZhciBjb21taXQgPSBfcmVmLmNvbW1pdDsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBpZiAoISF0b1JvdXRlICYmICEhdG9Sb3V0ZS5xdWVyeS5jb2RlKSB7CiAgICAgICAgICAoMCwgX2xvZ2luLmxvZ2luKSh7CiAgICAgICAgICAgIGNvZGU6IHRvUm91dGUucXVlcnkuY29kZQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdMb2dpbicsIHJlcyk7CiAgICAgICAgICAgICgwLCBfYXV0aC5zZXRUb2tlbikocmVzLkRhdGEuQXBpVG9rZW4gfHwgJycpOwogICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGNhbGxiYWNrVXJsID0gcHJvY2Vzcy5lbnYuVlVFX0FQUF9MT0dJTl9SRURJUkVDVF9VUkw7CiAgICAgICAgICB2YXIgbG9naW5VcmwgPSBwcm9jZXNzLmVudi5WVUVfQVBQX0xPR0lOX1VSTCArICc/cmVzcG9uc2VfdHlwZT1jb2RlJmNsaWVudF9pZD0xMzUwMjg0MjEmcmVkaXJlY3RfdXJpPScgKyBlbmNvZGVVUklDb21wb25lbnQoY2FsbGJhY2tVcmwpOwogICAgICAgICAgbG9jYXRpb24uaHJlZiA9IGxvZ2luVXJsOwogICAgICAgICAgcmVqZWN0KCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICAvLyDnmbvlvZUKICAgIFNldFVzZXJJbmZvOiBmdW5jdGlvbiBTZXRVc2VySW5mbyhfcmVmMiwgdXNlckluZm8pIHsKICAgICAgdmFyIGNvbW1pdCA9IF9yZWYyLmNvbW1pdDsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHt9KTsKICAgIH0sCiAgICAvLyDojrflj5bnlKjmiLfkv6Hmga8KICAgIEdldEluZm86IGZ1bmN0aW9uIEdldEluZm8oX3JlZjMpIHsKICAgICAgdmFyIGNvbW1pdCA9IF9yZWYzLmNvbW1pdCwKICAgICAgICAgIHN0YXRlID0gX3JlZjMuc3RhdGU7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgKDAsIF9sb2dpbi5nZXRJbmZvKShzdGF0ZS50b2tlbikudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICB2YXIgdXNlciA9IHJlcy51c2VyOwogICAgICAgICAgdmFyIGF2YXRhciA9IHVzZXIuYXZhdGFyID09PSAnJyA/ICfpu5jorqTlpLTlg4/lm77niYcnIDogcHJvY2Vzcy5lbnYuVlVFX0FQUF9CQVNFX0FQSSArIHVzZXIuYXZhdGFyOwoKICAgICAgICAgIGlmIChyZXMucm9sZXMgJiYgcmVzLnJvbGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgLy8g6aqM6K+B6L+U5Zue55qEcm9sZXPmmK/lkKbmmK/kuIDkuKrpnZ7nqbrmlbDnu4QKICAgICAgICAgICAgY29tbWl0KCdTRVRfUk9MRVMnLCByZXMucm9sZXMpOwogICAgICAgICAgICBjb21taXQoJ1NFVF9QRVJNSVNTSU9OUycsIHJlcy5wZXJtaXNzaW9ucyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb21taXQoJ1NFVF9ST0xFUycsIFsnUk9MRV9ERUZBVUxUJ10pOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbW1pdCgnU0VUX05BTUUnLCB1c2VyLnVzZXJOYW1lKTsKICAgICAgICAgIGNvbW1pdCgnU0VUX0FWQVRBUicsIGF2YXRhcik7CiAgICAgICAgICByZXNvbHZlKHJlcyk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICAvLyDpgIDlh7rns7vnu58KICAgIExvZ091dDogZnVuY3Rpb24gTG9nT3V0KF9yZWY0KSB7CiAgICAgIHZhciBjb21taXQgPSBfcmVmNC5jb21taXQsCiAgICAgICAgICBzdGF0ZSA9IF9yZWY0LnN0YXRlOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICgwLCBfbG9naW4ubG9nb3V0KShzdGF0ZS50b2tlbikudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBjb21taXQoJ1NFVF9UT0tFTicsICcnKTsKICAgICAgICAgIGNvbW1pdCgnU0VUX1JPTEVTJywgW10pOwogICAgICAgICAgY29tbWl0KCdTRVRfUEVSTUlTU0lPTlMnLCBbXSk7CiAgICAgICAgICAoMCwgX2F1dGgucmVtb3ZlVG9rZW4pKCk7CiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICAvLyDliY3nq68g55m75Ye6CiAgICBGZWRMb2dPdXQ6IGZ1bmN0aW9uIEZlZExvZ091dChfcmVmNSkgewogICAgICB2YXIgY29tbWl0ID0gX3JlZjUuY29tbWl0OwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICBjb21taXQoJ1NFVF9UT0tFTicsICcnKTsKICAgICAgICAoMCwgX2F1dGgucmVtb3ZlVG9rZW4pKCk7CiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KTsKICAgIH0KICB9Cn07CnZhciBfZGVmYXVsdCA9IHVzZXI7CmV4cG9ydHMuZGVmYXVsdCA9IF9kZWZhdWx0Ow=="},{"version":3,"sources":["/Users/caichaosen/Code/web/hrm-ui2/src/store/modules/user.js"],"names":["user","state","token","name","avatar","roles","permissions","mutations","SET_TOKEN","SET_NAME","SET_AVATAR","SET_ROLES","SET_PERMISSIONS","actions","Login","toRoute","commit","Promise","resolve","reject","query","code","then","res","console","log","Data","ApiToken","callbackUrl","process","env","VUE_APP_LOGIN_REDIRECT_URL","loginUrl","VUE_APP_LOGIN_URL","encodeURIComponent","location","href","SetUserInfo","userInfo","GetInfo","VUE_APP_BASE_API","length","userName","catch","error","LogOut","FedLogOut"],"mappings":"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","sourcesContent":["import { login, logout, getInfo } from '@/api/login'\nimport { getToken, setToken, removeToken } from '@/utils/auth'\n\nconst user = {\n  state: {\n    token: getToken(),\n    name: '',\n    avatar: '',\n    roles: [],\n    permissions: []\n  },\n\n  mutations: {\n    SET_TOKEN: (state, token) => {\n      state.token = token\n    },\n    SET_NAME: (state, name) => {\n      state.name = name\n    },\n    SET_AVATAR: (state, avatar) => {\n      state.avatar = avatar\n    },\n    SET_ROLES: (state, roles) => {\n      state.roles = roles\n    },\n    SET_PERMISSIONS: (state, permissions) => {\n      state.permissions = permissions\n    }\n  },\n\n  actions: {\n    Login({ commit }, toRoute) {\n      return new Promise((resolve, reject) => {\n        if (!!toRoute && !!toRoute.query.code) {\n          login({ code: toRoute.query.code }).then(res => {\n            console.log('Login', res)\n            setToken(res.Data.ApiToken || '')\n            resolve()\n          })\n        } else {\n          const callbackUrl = process.env.VUE_APP_LOGIN_REDIRECT_URL\n          const loginUrl = process.env.VUE_APP_LOGIN_URL + '?response_type=code&client_id=135028421&redirect_uri=' + encodeURIComponent(callbackUrl)\n          location.href = loginUrl\n          reject()\n        }\n      })\n    },\n    // 登录\n    SetUserInfo({ commit }, userInfo) {\n      return new Promise((resolve, reject) => {\n\n      })\n    },\n\n    // 获取用户信息\n    GetInfo({ commit, state }) {\n      return new Promise((resolve, reject) => {\n        getInfo(state.token).then(res => {\n          const user = res.user\n          const avatar = user.avatar === '' ? '默认头像图片' : process.env.VUE_APP_BASE_API + user.avatar\n          if (res.roles && res.roles.length > 0) { // 验证返回的roles是否是一个非空数组\n            commit('SET_ROLES', res.roles)\n            commit('SET_PERMISSIONS', res.permissions)\n          } else {\n            commit('SET_ROLES', ['ROLE_DEFAULT'])\n          }\n          commit('SET_NAME', user.userName)\n          commit('SET_AVATAR', avatar)\n          resolve(res)\n        }).catch(error => {\n          reject(error)\n        })\n      })\n    },\n\n    // 退出系统\n    LogOut({ commit, state }) {\n      return new Promise((resolve, reject) => {\n        logout(state.token).then(() => {\n          commit('SET_TOKEN', '')\n          commit('SET_ROLES', [])\n          commit('SET_PERMISSIONS', [])\n          removeToken()\n          resolve()\n        }).catch(error => {\n          reject(error)\n        })\n      })\n    },\n\n    // 前端 登出\n    FedLogOut({ commit }) {\n      return new Promise(resolve => {\n        commit('SET_TOKEN', '')\n        removeToken()\n        resolve()\n      })\n    }\n  }\n}\n\nexport default user\n"]}]}